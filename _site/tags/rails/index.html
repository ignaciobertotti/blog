<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    

    <title>Rails at The Lean Software Boutique</title>


    
    
    <meta name="description" content="Articles about Rails in the The Lean Software Boutique blog." />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Rails at The Lean Software Boutique">
    <meta itemprop="description" content="Articles about Rails in the The Lean Software Boutique blog.">
    <!-- meta itemprop="image" content="http://www.example.com/image.jpg" -->

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@OmbuLabs">

    <meta name="twitter:title" content="Rails at The Lean Software Boutique">
    <meta name="twitter:description" content="Articles about Rails in the The Lean Software Boutique blog.">
    <meta name="twitter:creator" content="@OmbuLabs">
    <!-- Twitter summary card with large image must be at least 280x150px -->
    <!-- meta name="twitter:image:src" content="http://www.example.com/image.html" -->

    <!-- Open Graph data -->
    <meta property="og:title" content="Rails at The Lean Software Boutique" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://www.ombulabs.com/tags/rails/" />
    <meta property="og:image" content="http://www.ombulabs.com/assets/isotype.png" />
    <meta property="og:description" content="Articles about Rails in the The Lean Software Boutique blog." />
    <meta property="og:site_name" content="Category: rails" />
    

    <meta property="fb:admins" content="10153304864537860" />

    <link rel="stylesheet" type="text/css" href="/blog/assets/css/screen.css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900,300italic,400italic,700italic|Maven+Pro" rel="stylesheet" type="text/css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/main.css" />
    <link rel="stylesheet" type="text/css" href="/assets/ombu_blog/application.css" />
</head>
<body class="home-template">
  <header class="main-header no-cover">
      <nav class="main-nav overlay clearfix">
              
              <a class="back-button icon-arrow-left"
                 href="/blog">Home</a>
          <a class="subscribe-button icon-feed" href="/blog/rss.xml">Subscribe</a>
      </nav>
      <div class="vertical">
          <div class="main-header-content inner">
              <h1 class="page-title logo"><a href="/blog">OmbuLabs Blog</a></h1>
              <h2 class="page-description slogan">
                   The Lean Software Boutique 
                  
              </h2>
          </div>
      </div>
      <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
  </header>
    <div id="wrapper">
      <h2 class="category-name">Articles about <span class="tag">Rails</span></h2>

<main id="content" class="content category">

  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/react/how-to-test-a-react-app-using-capybara-webkit.html">How to test a React app using capybara-webkit</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/react"
         title="Articles about React">React</a>



<time class="post-date" datetime="2017-02-10">
  10 Feb 2017
</time>

    </footer>
    <section class="post-excerpt">
        <p>I have been using the <a href="https://github.com/thoughtbot/capybara-webkit">capybara-webkit</a>
gem for a while now since I first tried it out after making the switch from
Capybara + Selenium.</p>

<p>Using capybara-webkit speeds up my Selenium tests due to its headless nature,
and it&#39;s very straightforward. However, I had some trouble testing a
<a href="http://rubyonrails.org">Rails</a> based React app.</p>

<p>In this post, I will explain how I worked around the issues that came up when
trying to use capybara-webkit with <a href="https://facebook.github.io/react">React</a>.</p>
 <a class="read-more" href="/blog/rails/react/how-to-test-a-react-app-using-capybara-webkit.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/ruby/how-to-use-any-gem-in-production-console.html">How to use any gem in the Rails production console</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>



<time class="post-date" datetime="2016-12-14">
  14 Dec 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>How many times did you come across a great gem you wanted to try out in
a production console, like <a href="https://github.com/evanphx/benchmark-ips">benchmark-ips</a>
or <a href="https://github.com/awesome-print/awesome_print">awesome-print</a>?</p>

<p>Be it for performance or for readability, sometimes it&#39;s nice to be able to try
out something new quickly without going through a pull request + deployment
process. This is possible by modifying the <a href="http://ruby-doc.org/core-2.3.0/doc/globals_rdoc.html">$LOAD_PATH</a>
Ruby global variable and requiring the gem manually.</p>
 <a class="read-more" href="/blog/rails/ruby/how-to-use-any-gem-in-production-console.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/benchmark/performance/rails/present-vs-any-vs-exists.html">Present? vs Any? vs Exists?</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/benchmark"
         title="Articles about Benchmark">Benchmark</a>,
      <a href="/blog/tags/performance"
         title="Articles about Performance">Performance</a>,
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>



<time class="post-date" datetime="2016-12-02">
  02 Dec 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>When working on a Rails project, you may have seen <code>present?</code> calls on
ActiveRecord relationships. This might feel natural, mostly because <code>present?</code>
exists on all objects <a href="http://guides.rubyonrails.org/active_support_core_extensions.html#blank-questionmark-and-present-questionmark">via ActiveSupport</a>, so you expect the relationship to respond to it,
but it&#39;s actually not a very good idea. If all we want to do is check if the
scope returns any results from the database, there are better ways than using
<code>present?</code>.</p>
 <a class="read-more" href="/blog/benchmark/performance/rails/present-vs-any-vs-exists.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/performance/rails/writing-fast-rails.html">Tips for Writing Fast Rails: Part 1</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/9299203e7e9b9ae35e39eb66f3155f15?s=50" alt="Ernesto Tagwerker" nopin="nopin" />
  
  <a href="/blog/authors/etagwerker"
     title="Articles by Ernesto Tagwerker">
     Ernesto Tagwerker
  </a>


 
  on
    
      <a href="/blog/tags/performance"
         title="Articles about Performance">Performance</a>,
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>



<time class="post-date" datetime="2016-10-11">
  11 Oct 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p><a href="http://rubyonrails.org/">Rails</a> is a powerful framework. You can write a lot of features in a short period of time. In the process you can easily write code that <strong>performs poorly</strong>.</p>

<p>At <a href="http://www.ombulabs.com">Ombu Labs</a> we like to <a href="http://www.ombulabs.com/blog/tags/maintenance">maintain Ruby on Rails
applications</a>. In the process
of maintaining them, adding features and fixing bugs, we like to improve
the code and its performance (because we are <a href="http://programmer.97things.oreilly.com/wiki/index.php/The_Boy_Scout_Rule">good <em>boy scouts</em></a>!)</p>

<p>Here are some tips based on our experience.</p>

<h2>Prefer <code>where</code> instead of <code>select</code></h2>

<p>When you are performing a lot of calculations, you should load as little as
possible into memory. <strong>Always</strong> prefer a SQL query vs. an object&#39;s method call.</p>
 <a class="read-more" href="/blog/performance/rails/writing-fast-rails.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/tips-for-upgrading-rails-3-2-to-4.html">Tips for upgrading from Rails 3.2 to 4.0</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>



<time class="post-date" datetime="2016-07-01">
  01 Jul 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>There are already quite a few guides in the wild to help with the upgrade of
Rails 3.2 to Rails 4.0.
The <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#upgrading-from-rails-3-2-to-rails-4-0">official Rails guide</a>
for upgrading from Rails 3.2 to 4.0 is very thorough.
With the recent release of Rails 5.0, apps currently in production running
Rails 3.2 should probably be updated to any stable Rails 4 release as soon as
possible.</p>

<p>There is even an e-book about
<a href="https://github.com/alindeman/upgradingtorails4">upgrading from Rails 3 to 4</a>,
which serves as a useful guide to make this upgrade easier, and also helps
understand the advantages &amp; disadvantages of this new (soon to be old) version.</p>

<p>However, if you&#39;re using any non-standard gems, you&#39;re mostly on your own. Some
gems stopped being maintained before Rails 4 was released, as was the case
with <a href="https://github.com/ryanb/cancan">CanCan</a>, a well known authorization
library. After many open pull requests were left <a href="https://github.com/ryanb/cancan/pulls">unmerged</a>,
<a href="https://github.com/CanCanCommunity/cancancan">CanCanCan</a> was released.
It is a community driven effort to have a semi-official fork of CanCan.
It serves as a drop-in replacement for people who want to use CanCan after
upgrading to Rails 4.</p>
 <a class="read-more" href="/blog/rails/tips-for-upgrading-rails-3-2-to-4.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/dry/dry-your-test-unit.html">DRY your tests</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/9299203e7e9b9ae35e39eb66f3155f15?s=50" alt="Ernesto Tagwerker" nopin="nopin" />
  
  <a href="/blog/authors/etagwerker"
     title="Articles by Ernesto Tagwerker">
     Ernesto Tagwerker
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/dry"
         title="Articles about Dry">Dry</a>



<time class="post-date" datetime="2016-05-16">
  16 May 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>I&#39;m a big fan of having small classes. I&#39;m not a big fan of having huge specs for
a small class/object. Every time I see an opportunity to
<a href="http://c2.com/cgi/wiki?DontRepeatYourself">DRY</a> my specs, I take it.</p>

<p>Today I wrote a spec to make sure that we gracefully ignore SPAMmy
contact requests in the Ombu Labs
<a href="http://www.ombulabs.com/contact">contact page</a>. It initially looked like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">test</span> <span class="s2">&quot;gracefully ignores spammy requests with valid attributes&quot;</span> <span class="k">do</span>
  <span class="vi">@valid_contact</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">(</span><span class="ss">:two</span><span class="p">)</span>
  <span class="n">attributes</span> <span class="o">=</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">attributes</span>
                             <span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">email_confirmation</span><span class="p">:</span> <span class="vi">@valid_contact</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>

  <span class="n">assert_no_difference</span><span class="p">(</span><span class="s2">&quot;Contact.count&quot;</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">post</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">contact</span><span class="p">:</span> <span class="n">attributes</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;js&#39;</span>
  <span class="k">end</span>

  <span class="n">assert_response</span> <span class="ss">:success</span>
<span class="k">end</span>
</code></pre></div>

<p>The new behavior adds a simple <a href="http://www.sitepoint.com/easy-spam-prevention-using-hidden-form-fields/">SPAM trap field</a>
that bots will usually fall for.
If a bot is submitting the <code>email_confirmation</code> field (which is hidden by a CSS
class), then it is <strong>SPAM</strong> and it gracefully ignores the request.</p>
 <a class="read-more" href="/blog/rails/dry/dry-your-test-unit.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/ruby/rails/sessions/session-user-flow.html">Use session variables to optimize your user flow</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/ff0ffbb39659d36ad6aabcd0b4715c1b?s=50" alt="Sirko Sittig" nopin="nopin" />
  
  <a href="/blog/authors/schmierkov"
     title="Articles by Sirko Sittig">
     Sirko Sittig
  </a>


 
  on
    
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>,
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/sessions"
         title="Articles about Sessions">Sessions</a>



<time class="post-date" datetime="2016-04-22">
  22 Apr 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>Sessions provide you a nice little data storage feature where the application does not need to get the information directly from the database. So you do not have to persist data in your database and can easily store info about the user on the fly. This is a nice way to enhance the user experience on your page.</p>

<p>Let&#39;s say that you want to show some users a new fancy sign up form and the rest the old form. If you store the version of the sign up form in a session variable, you don&#39;t need to persist this info in your database.</p>
 <a class="read-more" href="/blog/ruby/rails/sessions/session-user-flow.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/performance/hunting-down-a-slow-rails-request.html">Hunting Down a Slow Rails Request</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/performance"
         title="Articles about Performance">Performance</a>



<time class="post-date" datetime="2016-03-04">
  04 Mar 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>Recently, we started using <a href="https://www.skylight.io">Skylight</a> in production
for one of our clients&#39; Rails applications, in an attempt to try to improve the
performance of some of the more critical API endpoints.</p>

<p>Skylight reports on:</p>

<ul>
<li>Time taken per request</li>
<li>Breakdown of time taken per SQL query</li>
<li>Object allocations per request</li>
</ul>

<p>I noticed an unusually large amount of allocated objects for one request:</p>

<p><img src="/blog/assets/images/high-object-allocation.png" alt="Skylight report"></p>

<p>This request would take anywhere from 400ms to 3000ms to respond, which is
<strong>WAY</strong> too long.</p>
 <a class="read-more" href="/blog/rails/performance/hunting-down-a-slow-rails-request.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/maintenance/ten-steps-to-evaluate-a-rails-project.html">10 Steps to Evaluate a Rails Project</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/9299203e7e9b9ae35e39eb66f3155f15?s=50" alt="Ernesto Tagwerker" nopin="nopin" />
  
  <a href="/blog/authors/etagwerker"
     title="Articles by Ernesto Tagwerker">
     Ernesto Tagwerker
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/maintenance"
         title="Articles about Maintenance">Maintenance</a>



<time class="post-date" datetime="2016-02-17">
  17 Feb 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>It will come a time when you will have to decide whether to maintain a <a href="http://rubyonrails.org">Rails</a> project <strong>or not</strong>.</p>

<p>If you want to seriously consider it, you should follow these 10 steps:</p>

<h3>1. Setup the development environment</h3>

<p>Git clone the repository and try to start the server. Is the <code>README</code> clear enough? Can you follow the steps in the file and easily get started?</p>

<p>A lot of projects will have a <code>README</code> that is out of date and/or instructions that don&#39;t work right off the bat.</p>

<p>Most of the projects will define guidelines like these:</p>

<ul>
<li>Configure your <code>config/database.yml</code></li>
<li>Configure your <code>.env</code> file</li>
<li>Setup the database <code>rake db:create db:migrate db:seed</code></li>
<li>Start the server <code>rails server</code></li>
</ul>

<p>The best projects will have a one-liner that will setup the entire environment for you.</p>
 <a class="read-more" href="/blog/rails/maintenance/ten-steps-to-evaluate-a-rails-project.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/rspec/ruby/let-vs-instance.html">Let vs Instance Variables</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/ff0ffbb39659d36ad6aabcd0b4715c1b?s=50" alt="Sirko Sittig" nopin="nopin" />
  
  <a href="/blog/authors/schmierkov"
     title="Articles by Sirko Sittig">
     Sirko Sittig
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/rspec"
         title="Articles about Rspec">Rspec</a>,
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>



<time class="post-date" datetime="2016-01-22">
  22 Jan 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>Maybe in the past you stumbled over the two different approaches to setup your test variables. One way is the more programmatical approach by using instance variables, usually initialized in a <code>before</code> block.</p>
 <a class="read-more" href="/blog/rails/rspec/ruby/let-vs-instance.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/backbone/security/adding-csrf-protection-to-your-rails-backbone-app.html">Adding Csrf-Protection to your Rails-Backbone App</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/ff0ffbb39659d36ad6aabcd0b4715c1b?s=50" alt="Sirko Sittig" nopin="nopin" />
  
  <a href="/blog/authors/schmierkov"
     title="Articles by Sirko Sittig">
     Sirko Sittig
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/backbone"
         title="Articles about Backbone">Backbone</a>,
      <a href="/blog/tags/security"
         title="Articles about Security">Security</a>



<time class="post-date" datetime="2015-12-15">
  15 Dec 2015
</time>

    </footer>
    <section class="post-excerpt">
        <p>When integrating <a href="http://backbonejs.org">Backbone.js</a> in your <a href="http://rubyonrails.org">Rails</a> App, you might face the problem of the inability to verify the CSRF-Token.</p>

<p>The CSRF Protection secures your app with a token. Rails makes sure that the person who is interacting with your app is someone who started a session in your site, not some random attacker from another site. So you should not turn it off, unless you know what you are doing.</p>

<p>For more information on this Topic, check out the <a href="http://guides.rubyonrails.org/security.html#cross-site-request-forgery-csrf">Rails Security Guide</a>.</p>

<p>This problem occurs as soon as you are trying to send form data, without the CSRF-Token provided by Rails.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Started</span> <span class="no">POST</span> <span class="s2">&quot;/products&quot;</span> <span class="k">for</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">at</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">16</span> <span class="mi">10</span><span class="p">:</span><span class="mo">06</span><span class="p">:</span><span class="mo">05</span> <span class="o">-</span><span class="mo">0300</span>
<span class="no">Processing</span> <span class="n">by</span> <span class="no">ProductsController</span><span class="c1">#create as JSON</span>
  <span class="ss">Parameters</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;foo&quot;</span><span class="p">}}</span>
<span class="ss">WARNING</span><span class="p">:</span> <span class="no">Can</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">verify</span> <span class="no">CSRF</span> <span class="n">token</span> <span class="n">authenticity</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="no">Completed</span> <span class="mi">302</span> <span class="no">Found</span> <span class="k">in</span> <span class="mi">7</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span> <span class="p">(</span><span class="ss">ActiveRecord</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="n">ms</span><span class="p">)</span>
</code></pre></div>

<p>After this request, Rails will terminate your session and you will have to login again.</p>

<p>This problem is caused by your Backbone.js application, which is sending the data directly to the backend without providing the CSRF-Token.</p>

<p>To solve this problem you need to add the token to your Backbone request. One of the simplest solutions I came across is the following by <a href="https://github.com/shuvalov-anton/backbone-rails-sync">Anton Shuvalov</a>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// https://github.com/shuvalov-anton/backbone-rails-sync</span>
<span class="nx">Backbone</span><span class="p">.</span><span class="nx">_sync</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">sync</span><span class="p">;</span>
<span class="nx">Backbone</span><span class="p">.</span><span class="nx">sync</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">noCSRF</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">beforeSend</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">beforeSend</span><span class="p">;</span>

    <span class="c1">// Set X-CSRF-Token HTTP header</span>
    <span class="nx">options</span><span class="p">.</span><span class="nx">beforeSend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;meta[name=&quot;csrf-token&quot;]&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">&#39;X-CSRF-Token&#39;</span><span class="p">,</span> <span class="nx">token</span><span class="p">);</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">beforeSend</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">beforeSend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">_sync</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>

<p>It grabs the CSRF-Token provided in the meta tags of your Rails application and sets it for the request header field <code>X-CSRF-Token</code>.</p>

<p>After adding this to the Backbone code, it works as expected.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Started</span> <span class="no">POST</span> <span class="s2">&quot;/products&quot;</span> <span class="k">for</span> <span class="mi">127</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="mi">1</span> <span class="n">at</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">16</span> <span class="mi">10</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">29</span> <span class="o">-</span><span class="mo">0300</span>
<span class="no">Processing</span> <span class="n">by</span> <span class="no">ProductsController</span><span class="c1">#create as JSON</span>
  <span class="ss">Parameters</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;product&quot;</span><span class="o">=&gt;</span><span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;foo&quot;</span><span class="p">}}</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="no">Completed</span> <span class="mi">200</span> <span class="no">OK</span> <span class="k">in</span> <span class="mi">40</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span> <span class="p">(</span><span class="ss">Views</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">6</span><span class="n">ms</span> <span class="o">|</span> <span class="ss">ActiveRecord</span><span class="p">:</span> <span class="mi">10</span><span class="o">.</span><span class="mi">3</span><span class="n">ms</span><span class="p">)</span>
</code></pre></div>
 <a class="read-more" href="/blog/rails/backbone/security/adding-csrf-protection-to-your-rails-backbone-app.html">Read more &raquo;</a>
    </section>
</article>


  <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html">Why using default_scope is a bad idea</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>,
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/best-practices"
         title="Articles about Best Practices">Best Practices</a>



<time class="post-date" datetime="2015-07-20">
  20 Jul 2015
</time>

    </footer>
    <section class="post-excerpt">
        <p><code>default_scope</code> is a method provided by ActiveRecord, which allows you to set
a default scope (as its name implies) for all operations done on a given model.
It can be useful for allowing soft-deletion in your models, by having a
<code>deleted_on</code> column on your model and setting the default scope to
<code>deleted_on: nil</code></p>
 <a class="read-more" href="/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html">Read more &raquo;</a>
    </section>
</article>


<footer class="site-footer clearfix">
  <section class="copyright">
    <figure>
      <img src="/blog/assets/images/creative-commons.png"
           alt="Creative Commons Attribution-NonCommercial">
      <figcaption>
        <a href="http://creativecommons.org/licenses/by-nc/3.0/"
           target="_blank"
           title="Creative Commons Attribution-NonCommercial">Creative Commons Attribution-NonCommercial</a>
      </figcaption>
    </figure>
  </section>
  <section class="poweredby">Made with love using <a href="https://github.com/jekyll/jekyll" target="_blank">Jekyll</a> and
    <a target="_blank" href="http://github.com/rosario/kasper">Kasper theme</a>
  </section>
</footer>

</main>

      <div id="sidebar">
  <h2 class="category-name">Listing all tags</h2>
    

    
    
        <h3 class="tag-name">
          <a href="/blog/tags/"
             title="Articles about "></a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/agile"
             title="Articles about Agile">Agile</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/backbone"
             title="Articles about Backbone">Backbone</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/benchmark"
             title="Articles about Benchmark">Benchmark</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/best-practices"
             title="Articles about Best Practices">Best Practices</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/bugs"
             title="Articles about Bugs">Bugs</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/conventions"
             title="Articles about Conventions">Conventions</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/crowdsourcing"
             title="Articles about Crowdsourcing">Crowdsourcing</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/design"
             title="Articles about Design">Design</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/docker"
             title="Articles about Docker">Docker</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/dry"
             title="Articles about Dry">Dry</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/git"
             title="Articles about Git">Git</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/github"
             title="Articles about Github">Github</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/hubot"
             title="Articles about Hubot">Hubot</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/imap"
             title="Articles about Imap">Imap</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/jobs"
             title="Articles about Jobs">Jobs</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/lean-startup"
             title="Articles about Lean Startup">Lean Startup</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/linux"
             title="Articles about Linux">Linux</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/maintenance"
             title="Articles about Maintenance">Maintenance</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/mvp"
             title="Articles about Mvp">Mvp</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/open-source"
             title="Articles about Open Source">Open Source</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/pair-programming"
             title="Articles about Pair Programming">Pair Programming</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/performance"
             title="Articles about Performance">Performance</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/protractor"
             title="Articles about Protractor">Protractor</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rails"
             title="Articles about Rails">Rails</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/react"
             title="Articles about React">React</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rspec"
             title="Articles about Rspec">Rspec</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/ruby"
             title="Articles about Ruby">Ruby</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rubygems"
             title="Articles about Rubygems">Rubygems</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/security"
             title="Articles about Security">Security</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/sessions"
             title="Articles about Sessions">Sessions</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/software-development"
             title="Articles about Software Development">Software Development</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/software-quality"
             title="Articles about Software Quality">Software Quality</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/team"
             title="Articles about Team">Team</a>
        </h3>
    
</div>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script type="text/javascript" src="/blog/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-17795190-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</body>
</html>
