<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    

    <title>Articles by Mauro Otonelli - The Lean Software Boutique</title>


    
    
    <meta name="description" content="" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="Articles by Mauro Otonelli - The Lean Software Boutique">
    <meta itemprop="description" content="">
    <!-- meta itemprop="image" content="http://www.example.com/image.jpg" -->

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@OmbuLabs">

    <meta name="twitter:title" content="Articles by Mauro Otonelli - The Lean Software Boutique">
    <meta name="twitter:description" content="">
    <meta name="twitter:creator" content="@OmbuLabs">
    <!-- Twitter summary card with large image must be at least 280x150px -->
    <!-- meta name="twitter:image:src" content="http://www.example.com/image.html" -->

    <!-- Open Graph data -->
    <meta property="og:title" content="Articles by Mauro Otonelli - The Lean Software Boutique" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://www.ombulabs.com/authors/mauro-oto/" />
    <meta property="og:image" content="http://www.ombulabs.com/assets/isotype.png" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="Articles by Mauro Otonelli by @mauro_oto" />
    

    <meta property="fb:admins" content="10153304864537860" />

    <link rel="stylesheet" type="text/css" href="/blog/assets/css/screen.css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900,300italic,400italic,700italic|Maven+Pro" rel="stylesheet" type="text/css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/main.css" />
    <link rel="stylesheet" type="text/css" href="/assets/ombu_blog/application.css" />
</head>
<body class="home-template">
  <header class="main-header no-cover">
      <nav class="main-nav overlay clearfix">
              
              <a class="back-button icon-arrow-left"
                 href="/blog">Home</a>
          <a class="subscribe-button icon-feed" href="/blog/rss.xml">Subscribe</a>
      </nav>
      <div class="vertical">
          <div class="main-header-content inner">
              <h1 class="page-title logo"><a href="/blog">OmbuLabs Blog</a></h1>
              <h2 class="page-description slogan">
                   The Lean Software Boutique 
                  
              </h2>
          </div>
      </div>
      <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
  </header>
    <div id="wrapper">
      
<h2 class="author-name">Articles by <span class="tag">Mauro Otonelli</span>
</h2>
<h3 class="author-description"><a href="http://twitter.com/mauro_oto"
                                      title="Mauro Otonelli on Twitter"
                                      target="_blank">Follow @mauro-oto on Twitter</a></h3>

<main id="content" class="content category">

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/upgrades/upgrade-rails-from-3-2-to-4-0.html">Upgrade Rails from 3.2 to 4.0</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/upgrades"
         title="Articles about Upgrades">Upgrades</a>



<time class="post-date" datetime="2017-11-06">
  06 Nov 2017
</time>

    </footer>
    <section class="post-excerpt">
        <p><em>This article is part of our Upgrade Rails series. To see more of them, <a href="https://www.ombulabs.com/blog/tags/upgrades">click here</a></em>.</p>

<p>A <a href="https://www.ombulabs.com/blog/rails/tips-for-upgrading-rails-3-2-to-4.html">previous post</a>
covered some general tips to take into account for this migration. This article
will try to go a bit more in depth. We will first go from 3.2 to 4.0, then to
4.1 and finally to 4.2. Depending on the complexity of your app, a Rails upgrade
can take anywhere from one week for a single developer, to a few months for two
developers.</p>

<ol>
<li><a href="#ruby-version">Ruby version</a></li>
<li><a href="#gems">Gems</a></li>
<li><a href="#config-files">Config files (config/)</a></li>
<li><a href="#application-code">Application code</a>

<ol>
<li><a href="#models">Models (app/models/)</a></li>
<li><a href="#controllers">Controllers (app/controllers/)</a></li>
</ol></li>
<li><a href="#tests">Tests</a></li>
<li><a href="#miscellaneous">Miscellaneous</a></li>
<li><a href="#next-steps">Next steps</a></li>
</ol>

<h2 id="ruby-version">1. Ruby version</h2>

<p>Rails 3.2.x is the last version to support Ruby 1.8.7. If you&#39;re using Ruby 1.8.7,
you&#39;ll need to upgrade to Ruby 1.9.3 or newer. The Ruby upgrade is not covered
in this guide, but check out <a href="http://www.darkridge.com/%7Ejpr5/2012/10/03/ruby-1.8.7-1.9.3-migration">this guide</a> for more details on that.</p>

<h2 id="gems">2. Gems</h2>

<p>You can add the aptly named <a href="https://github.com/alindeman/rails4_upgrade">rails4_upgrade gem</a>
to your Rails 3 project&#39;s Gemfile and find gems which you&#39;ll need to update:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>➜  myproject git:(develop) ✗ bundle exec rake rails4:check

** GEM COMPATIBILITY CHECK **
+------------------------------------------+----------------------------+
| Dependency Path                          | Rails Requirement          |
+------------------------------------------+----------------------------+
| devise 2.1.4                             | railties ~&gt; 3.1            |
| devise-encryptable 0.2.0 -&gt; devise 2.1.4 | railties ~&gt; 3.1            |
| friendly_id 4.0.10.1                     | activerecord &lt; 4.0, &gt;= 3.0 |
| strong_parameters 0.2.3                  | actionpack ~&gt; 3.0          |
| strong_parameters 0.2.3                  | activemodel ~&gt; 3.0         |
| strong_parameters 0.2.3                  | activesupport ~&gt; 3.0       |
| strong_parameters 0.2.3                  | railties ~&gt; 3.0            |
+------------------------------------------+----------------------------+
</code></pre></div>

<p>Instead of going through your currently bundled gems or <code>Gemfile.lock</code> manually,
you get a report of the gems you need to upgrade.</p>

<h2 id="config-files">3. Config files</h2>

<p>Rails includes the <code>rails:update</code> <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#the-update-task">task</a>.
You can use this task as a guideline as explained thoroughly in
<a href="http://thomasleecopeland.com/2015/08/06/running-rails-update.html">this post</a>.
It will help you get rid of unnecessary code or monkey-patches in your config
files and initializers, specially if your Rails 3 app was running on Rails 2.</p>

<p>As an alternative, check out <a href="http://railsdiff.org/3.2.22.5/4.0.13">RailsDiff</a>,
which provides an overview of the changes in a basic Rails app between 3.2 and
4.0 (or any other source/target versions).</p>

<p>If you&#39;re feeling adventurous, you
can give <a href="https://github.com/bsodmike/upgrade_rails_3.2.12_to_4.0.0.beta1">this script</a>
a try. It attempts to apply <a href="https://github.com/bsodmike/upgrade_rails_3.2.12_to_4.0.0.beta1/blob/master/upgrade/upgrade.patch">this git patch</a>
(similar to the patch shown on RailsDiff) to your Rails app to migrate from 3.2
to 4.0. However, I don&#39;t recommend this for complex or mature apps, as there
will be plenty of conflicts.</p>

<h2 id="application-code">4. Application code</h2>

<h2 id="models">a. Models</h2>

<ul>
<li>All dynamic finder methods except for <code>.find_by_...</code> are deprecated:</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># before:</span>
<span class="no">Authentication</span><span class="o">.</span><span class="n">find_all_by_provider_and_uid</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>

<span class="c1"># after:</span>
<span class="no">Authentication</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">provider</span><span class="p">:</span> <span class="n">provider</span><span class="p">,</span> <span class="ss">uid</span><span class="p">:</span> <span class="n">uid</span><span class="p">)</span>
</code></pre></div>

<p>You can regain usage of these finders by adding the gem
<a href="https://github.com/rails/activerecord-deprecated_finders">activerecord-deprecated_finders</a></p>

<ul>
<li>ActiveRecord scopes now need a lambda:</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># before:</span>
<span class="n">default_scope</span> <span class="n">where</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span>

<span class="c1"># after:</span>
<span class="n">default_scope</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">deleted_at</span><span class="p">:</span> <span class="kp">nil</span><span class="p">)</span> <span class="p">}</span>

<span class="c1"># before:</span>
<span class="n">has_many</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">order</span><span class="p">:</span> <span class="s1">&#39;position&#39;</span>

<span class="c1"># after:</span>
<span class="n">has_many</span> <span class="ss">:posts</span><span class="p">,</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">order</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>

<p>(Friendly reminder: beware when using <a href="https://www.ombulabs.com/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html">default_scope</a>)</p>

<ul>
<li>Protected attributes is deprecated, but you can still add the <a href="https://github.com/rails/protected_attributes">protected_attributes</a> gem.
However, since the Rails core team dropped its support since Rails 5.0, you
should begin migrating your models to <a href="http://guides.rubyonrails.org/action_controller_overview.html#strong-parameters">Strong Parameters</a> anyway.</li>
</ul>

<p>To do so, you will need to remove calls to <code>attr_accessible</code> from your models,
and add a new method to your model&#39;s controller with a name like <code>user_params</code>
or <code>your_model_params</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">user_params</span>
    <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p>Finally, change (most) references to <code>params[:user]</code> to <code>user_params</code> in your
controller&#39;s actions. If the reference is for an update or a creation, like
<code>user.update_attributes(params[:user])</code>, change it to <code>user.update_attributes(user_params)</code>.
This new method permits using the <code>name</code> and <code>email</code> attributes of the user
model and disallows writing any other attribute the user model may have (like <code>id</code>).</p>

<ul>
<li>ActiveRecord Observers were removed from the Rails 4.0 codebase and extracted
into a gem. You can regain usage by adding the gem to your Gemfile:</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;rails-observers&#39;</span> <span class="c1"># https://github.com/rails/rails-observers</span>
</code></pre></div>

<p>As an alternative, you can take a look at the <a href="https://github.com/krisleech/wisper">wisper gem</a>,
or Rails&#39; Concerns (which were added in Rails 4.0) for a slightly different
approach.</p>

<ul>
<li>ActiveResource was removed and extracted into its own gem:</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;active_resource&#39;</span> <span class="c1"># https://github.com/rails/activeresource</span>
</code></pre></div>

<h2 id="controllers">b. Controllers</h2>

<ul>
<li>ActionController Sweeper was extracted into the <code>rails-observers</code> gem, you can
regain usage by adding the gem to your Gemfile:</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;rails-observers&#39;</span> <span class="c1"># https://github.com/rails/rails-observers</span>
</code></pre></div>

<ul>
<li>Action caching was extracted into its own gem, so if you&#39;re using this feature
through either:</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">caches_page</span>   <span class="ss">:public</span>
</code></pre></div>

<p>or:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">caches_action</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span>
</code></pre></div>

<p>You will need to add the gem:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="n">gem</span> <span class="s1">&#39;actionpack-action_caching&#39;</span> <span class="c1"># https://github.com/rails/actionpack-action_caching</span>
</code></pre></div>

<h2 id="tests">5. Tests</h2>

<p>From Ruby 1.9.x onwards, you have to include the <a href="https://rubygems.org/gems/test-unit"><code>test-unit</code> gem</a>
in your Gemfile as it was removed from the standard lib. As an alternative,
migrate to <code>Minitest</code>, <code>RSpec</code> or your favorite test framework.</p>

<h2 id="miscellaneous">6. Miscellaneous</h2>

<ul>
<li>Routes now require you to specify the request method, so you no longer can
rely on the catch-all default.</li>
</ul>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="c1"># change:</span>
<span class="n">match</span> <span class="s1">&#39;/home&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;home#index&#39;</span>

<span class="c1"># to:</span>
<span class="n">match</span> <span class="s1">&#39;/home&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;home#index&#39;</span><span class="p">,</span> <span class="ss">via</span><span class="p">:</span> <span class="ss">:get</span>

<span class="c1"># or:</span>
<span class="n">get</span> <span class="s1">&#39;/home&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;home#index&#39;</span>
</code></pre></div>

<ul>
<li>Rails 4.0 dropped support for plugins, so you&#39;ll need to replace them with gems,
either by searching for the project on <a href="https://rubygems.org">RubyGems</a>/<a href="https://github.com">Github</a>,
or by moving the plugin to your <code>lib</code> directory and require it from somewhere
within your Rails app.</li>
</ul>

<h2 id="next-steps">7. Next steps</h2>

<p>If you successfully followed all of these steps, by now you should be running Rails 4.0!</p>

<p>To fine-tune your app, check out <a href="https://fastruby.io">FastRuby.io</a>, and feel
free to tell us how your upgrade went.</p>
 <a class="read-more" href="/blog/rails/upgrades/upgrade-rails-from-3-2-to-4-0.html">Read more &raquo;</a>
    </section>
</article>

  

  

  

  

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rspec/continuous-integration/how-to-track-down-a-flaky-test.html">'Flaky' tests: a short story</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rspec"
         title="Articles about Rspec">Rspec</a>,
      <a href="/blog/tags/continuous-integration"
         title="Articles about Continuous Integration">Continuous Integration</a>



<time class="post-date" datetime="2017-05-04">
  04 May 2017
</time>

    </footer>
    <section class="post-excerpt">
        <p>One of the hardest failing tests to debug are those which fail randomly, also
known as <strong>&quot;flaky&quot;</strong> tests. You write your test cases, you run the tests in your
environment (in random order), and see them all pass. Afterwards, you push your
code, your CI server runs them and <em>one test fails</em>.</p>

<p>This is not an uncommon scenario, and one <em>too common</em> when using integration
tests which use JS, with <code>Capybara-Webkit</code> or <code>Selenium</code>.
But if your failing test doesn&#39;t communicate with an external API, doesn&#39;t use
JS, and passes locally, it can be a bit nerve-wracking.</p>

<p>After you have identified the failing test, and it still passes after running it
locally, one way to figure out <strong>why</strong> it&#39;s failing is running its context
multiple times.</p>

<p>To automate this process a bit, I like to use the following command:</p>
 <a class="read-more" href="/blog/rspec/continuous-integration/how-to-track-down-a-flaky-test.html">Read more &raquo;</a>
    </section>
</article>

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/react/how-to-test-a-react-app-using-capybara-webkit.html">How to test a React app using capybara-webkit</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/react"
         title="Articles about React">React</a>



<time class="post-date" datetime="2017-02-13">
  13 Feb 2017
</time>

    </footer>
    <section class="post-excerpt">
        <p>I have been using the <a href="https://github.com/thoughtbot/capybara-webkit">capybara-webkit</a>
gem for a while now since I first tried it out after making the switch from
Capybara + Selenium.</p>

<p>Using capybara-webkit speeds up my Selenium tests due to its headless nature,
and it&#39;s very straightforward. However, I had some trouble testing a
<a href="http://rubyonrails.org">Rails</a> based React app.</p>

<p>In this post, I will explain how I worked around the issues that came up when
trying to use capybara-webkit with <a href="https://facebook.github.io/react">React</a>.</p>
 <a class="read-more" href="/blog/rails/react/how-to-test-a-react-app-using-capybara-webkit.html">Read more &raquo;</a>
    </section>
</article>

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/ruby/how-to-use-any-gem-in-production-console.html">How to use any gem in the Rails production console</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>



<time class="post-date" datetime="2016-12-14">
  14 Dec 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>How many times did you come across a great gem you wanted to try out in
a production console, like <a href="https://github.com/evanphx/benchmark-ips">benchmark-ips</a>
or <a href="https://github.com/awesome-print/awesome_print">awesome-print</a>?</p>

<p>Be it for performance or for readability, sometimes it&#39;s nice to be able to try
out something new quickly without going through a pull request + deployment
process. This is possible by modifying the <a href="http://ruby-doc.org/core-2.3.0/doc/globals_rdoc.html">$LOAD_PATH</a>
Ruby global variable and requiring the gem manually.</p>
 <a class="read-more" href="/blog/rails/ruby/how-to-use-any-gem-in-production-console.html">Read more &raquo;</a>
    </section>
</article>

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/benchmark/performance/rails/present-vs-any-vs-exists.html">Present? vs Any? vs Exists?</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/benchmark"
         title="Articles about Benchmark">Benchmark</a>,
      <a href="/blog/tags/performance"
         title="Articles about Performance">Performance</a>,
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>



<time class="post-date" datetime="2016-12-02">
  02 Dec 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>When working on a Rails project, you may have seen <code>present?</code> calls on
ActiveRecord relationships. This might feel natural, mostly because <code>present?</code>
exists on all objects <a href="http://guides.rubyonrails.org/active_support_core_extensions.html#blank-questionmark-and-present-questionmark">via ActiveSupport</a>, so you expect the relationship to respond to it,
but it&#39;s actually not a very good idea. If all we want to do is check if the
scope returns any results from the database, there are better ways than using
<code>present?</code>.</p>
 <a class="read-more" href="/blog/benchmark/performance/rails/present-vs-any-vs-exists.html">Read more &raquo;</a>
    </section>
</article>

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rspec/ruby/using-rspecs-documentation-format.html">Brief look at RSpec's formatting options</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rspec"
         title="Articles about Rspec">Rspec</a>,
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>



<time class="post-date" datetime="2016-11-08">
  08 Nov 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>A few weeks ago, I noticed weird output in the <a href="https://relishapp.com/rspec">RSpec</a>
test suite (~4000 tests) for a <a href="http://rubyonrails.org">Rails</a> application:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text"><span></span>.............................................................................................unknown OID 353414: failed to recognize type of &#39;&lt;field&gt;&#39;. It will be treated as String  ...........................................................................................................................................
</code></pre></div>

<p>This Rails app uses a <a href="https://www.postgresql.org">PostgreSQL</a> database. After
some Googling, it turns out that this is a warning from PostgreSQL. When the
database doesn&#39;t recognize the type to use for a column, it casts to string by
default.</p>
 <a class="read-more" href="/blog/rspec/ruby/using-rspecs-documentation-format.html">Read more &raquo;</a>
    </section>
</article>

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rspec/ruby/spy-vs-double-vs-instance-double.html">Spy vs Double vs Instance Double</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rspec"
         title="Articles about Rspec">Rspec</a>,
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>



<time class="post-date" datetime="2016-08-17">
  17 Aug 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>When writing tests for services, you may sometimes want to use mock objects
instead of real objects. In case you&#39;re using ActiveRecord and real
objects, your tests may hit the database and slow down your suite. The
latest release of the <a href="https://github.com/rspec/rspec-mocks">rspec-mocks</a>
library bundled with <a href="http://rspec.info">RSpec 3</a> includes at least three
different ways to implement a mock object.</p>

<p>Let&#39;s discuss some of the differences between a <code>spy</code>, a <code>double</code> and an
<code>instance_double</code>. First, the <code>spy</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span></span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;rspec/mocks/standalone&#39;</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">user_spy</span> <span class="o">=</span> <span class="n">spy</span><span class="p">(</span><span class="no">User</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Double User&gt;</span>
<span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">spy</span><span class="o">.</span><span class="n">whatever_method</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Double (anonymous)&gt;</span>
</code></pre></div>
 <a class="read-more" href="/blog/rspec/ruby/spy-vs-double-vs-instance-double.html">Read more &raquo;</a>
    </section>
</article>

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/tips-for-upgrading-rails-3-2-to-4.html">Tips for upgrading from Rails 3.2 to 4.0</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>



<time class="post-date" datetime="2016-07-01">
  01 Jul 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>There are already quite a few guides in the wild to help with the upgrade of
Rails 3.2 to Rails 4.0.
The <a href="http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html#upgrading-from-rails-3-2-to-rails-4-0">official Rails guide</a>
for upgrading from Rails 3.2 to 4.0 is very thorough.
With the recent release of Rails 5.0, apps currently in production running
Rails 3.2 should probably be updated to any stable Rails 4 release as soon as
possible.</p>

<p>There is even an e-book about
<a href="https://github.com/alindeman/upgradingtorails4">upgrading from Rails 3 to 4</a>,
which serves as a useful guide to make this upgrade easier, and also helps
understand the advantages &amp; disadvantages of this new (soon to be old) version.</p>

<p>However, if you&#39;re using any non-standard gems, you&#39;re mostly on your own. Some
gems stopped being maintained before Rails 4 was released, as was the case
with <a href="https://github.com/ryanb/cancan">CanCan</a>, a well known authorization
library. After many open pull requests were left <a href="https://github.com/ryanb/cancan/pulls">unmerged</a>,
<a href="https://github.com/CanCanCommunity/cancancan">CanCanCan</a> was released.
It is a community driven effort to have a semi-official fork of CanCan.
It serves as a drop-in replacement for people who want to use CanCan after
upgrading to Rails 4.</p>
 <a class="read-more" href="/blog/rails/tips-for-upgrading-rails-3-2-to-4.html">Read more &raquo;</a>
    </section>
</article>

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/ruby/imap/a-comprehensive-guide-to-interacting-with-imap-using-ruby.html">A comprehensive guide to interacting with IMAP using Ruby</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>,
      <a href="/blog/tags/imap"
         title="Articles about Imap">Imap</a>



<time class="post-date" datetime="2016-05-30">
  30 May 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>A few times in the past I&#39;ve had to interact with IMAP via Ruby, and wrapping
your head around its API is not so easy. Not only is the <a href="https://tools.ietf.org/html/rfc3501">IMAP API</a>
a bit obscure and cryptic, but Ruby&#39;s IMAP <a href="http://ruby-doc.org/stdlib-2.2.3/libdoc/net/imap/rdoc/Net/IMAP.html">documentation</a>
is not so great either.</p>

<p>Searching the internet for examples doesn&#39;t yield too many results, so I&#39;ll try
to write down some of the things I&#39;ve learned. The examples I&#39;ll show use
Gmail as the target IMAP server.</p>
 <a class="read-more" href="/blog/ruby/imap/a-comprehensive-guide-to-interacting-with-imap-using-ruby.html">Read more &raquo;</a>
    </section>
</article>

  

  

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/ruby/performance/using-bumbler-to-reduce-runtime-dependencies.html">Using Bumbler to reduce runtime dependencies</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>,
      <a href="/blog/tags/performance"
         title="Articles about Performance">Performance</a>



<time class="post-date" datetime="2016-04-25">
  25 Apr 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>A few weeks ago, I found an interesting project called
 <a href="https://github.com/nevir/Bumbler">Bumbler</a>. If your project uses Bundler,
 Bumbler shows you your project&#39;s largest dependencies.
When you find yourself staring at the screen after running
 <code>bundle exec rails c</code>, you may want to give this tool a try.</p>
 <a class="read-more" href="/blog/ruby/performance/using-bumbler-to-reduce-runtime-dependencies.html">Read more &raquo;</a>
    </section>
</article>

  

  

  

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/rails/performance/hunting-down-a-slow-rails-request.html">Hunting Down a Slow Rails Request</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/performance"
         title="Articles about Performance">Performance</a>



<time class="post-date" datetime="2016-03-04">
  04 Mar 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p>Recently, we started using <a href="https://www.skylight.io">Skylight</a> in production
for one of our clients&#39; Rails applications, in an attempt to try to improve the
performance of some of the more critical API endpoints.</p>

<p>Skylight reports on:</p>

<ul>
<li>Time taken per request</li>
<li>Breakdown of time taken per SQL query</li>
<li>Object allocations per request</li>
</ul>

<p>I noticed an unusually large amount of allocated objects for one request:</p>

<p><img src="/blog/assets/images/high-object-allocation.png" alt="Skylight report"></p>

<p>This request would take anywhere from 400ms to 3000ms to respond, which is
<strong>WAY</strong> too long.</p>
 <a class="read-more" href="/blog/rails/performance/hunting-down-a-slow-rails-request.html">Read more &raquo;</a>
    </section>
</article>

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/hubot/linux/set-up-and-run-hubot-in-non-heroku-server.html">Set up and run Hubot without using Heroku</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/hubot"
         title="Articles about Hubot">Hubot</a>,
      <a href="/blog/tags/linux"
         title="Articles about Linux">Linux</a>



<time class="post-date" datetime="2016-01-29">
  29 Jan 2016
</time>

    </footer>
    <section class="post-excerpt">
        <p><a href="https://hubot.github.com">Hubot</a> makes it incredibly easy to setup on a Heroku
server, by taking advantage of its Procfile support. Simply running
<code>git push heroku master</code> deploys the app and starts it.</p>

<p>When it comes to deploying to your own Linux server, given that
<code>foreman</code> doesn&#39;t really like background processes (see:
<a href="https://github.com/ddollar/foreman/issues/65">ddollar/foreman#65</a>), you need to
use something like <code>monit</code>, <code>systemd</code> or <code>tmux</code> to better manage your Hubot
process.</p>
 <a class="read-more" href="/blog/hubot/linux/set-up-and-run-hubot-in-non-heroku-server.html">Read more &raquo;</a>
    </section>
</article>

  

  

  

  

  

  

  

  

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/ruby/slack-notifications-with-slack-notify.html">Slack notifications with Slack-Notify gem</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>



<time class="post-date" datetime="2015-07-29">
  29 Jul 2015
</time>

    </footer>
    <section class="post-excerpt">
        <p>We have been using Slack at <a href="http://www.ombulabs.com">OmbuLabs</a> for a while now
after switching from HipChat, and haven&#39;t looked back. It looks and feels much
better than any other available platform of its kind. Slack provides
<a href="https://api.slack.com/incoming-webhooks">WebHooks</a>, which you can use to post
messages to your team&#39;s channels.</p>
 <a class="read-more" href="/blog/ruby/slack-notifications-with-slack-notify.html">Read more &raquo;</a>
    </section>
</article>

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html">Why using default_scope is a bad idea</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>,
      <a href="/blog/tags/rails"
         title="Articles about Rails">Rails</a>,
      <a href="/blog/tags/best-practices"
         title="Articles about Best Practices">Best Practices</a>



<time class="post-date" datetime="2015-07-20">
  20 Jul 2015
</time>

    </footer>
    <section class="post-excerpt">
        <p><code>default_scope</code> is a method provided by ActiveRecord, which allows you to set
a default scope (as its name implies) for all operations done on a given model.
It can be useful for allowing soft-deletion in your models, by having a
<code>deleted_on</code> column on your model and setting the default scope to
<code>deleted_on: nil</code></p>
 <a class="read-more" href="/blog/ruby/rails/best-practices/why-using-default-scope-is-a-bad-idea.html">Read more &raquo;</a>
    </section>
</article>

  

  

  

  

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/ruby/benchmark/enumerator-grep-vs-enumerator-select.html">Enumerable#grep vs Enumerable#select</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/ruby"
         title="Articles about Ruby">Ruby</a>,
      <a href="/blog/tags/benchmark"
         title="Articles about Benchmark">Benchmark</a>



<time class="post-date" datetime="2015-04-09">
  09 Apr 2015
</time>

    </footer>
    <section class="post-excerpt">
        <p>Often, <code>Enumerable#select</code> is the chosen method to obtain elements from an
Array for a given block. Without thinking twice, we may be doing more work than
necessary by not taking advantage of another method from the Enumerable module,
<code>Enumerable#grep</code>.</p>
 <a class="read-more" href="/blog/ruby/benchmark/enumerator-grep-vs-enumerator-select.html">Read more &raquo;</a>
    </section>
</article>

  

  
    <article class="post">
    <header class="post-header">
        <h2 class="post-title">
          <a href="/blog/git/github/4-useful-github-tricks.html">4 Useful Github tricks which should be more popular</a>
        </h2>
    </header>
    <footer class="post-meta">
      


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/350875eb8fce8553e12040c5a1f5d5d0?s=50" alt="Mauro Otonelli" nopin="nopin" />
  
  <a href="/blog/authors/mauro-oto"
     title="Articles by Mauro Otonelli">
     Mauro Otonelli
  </a>


 
  on
    
      <a href="/blog/tags/git"
         title="Articles about Git">Git</a>,
      <a href="/blog/tags/github"
         title="Articles about Github">Github</a>



<time class="post-date" datetime="2015-01-19">
  19 Jan 2015
</time>

    </footer>
    <section class="post-excerpt">
        <p>If you are using git in 2015, you are probably also using <a href="http://www.github.com">Github</a>, unless you&#39;re self-hosting or still betting on <a href="http://www.bitbucket.com">Bitbucket</a>.</p>

<p>Below are some cool, useful tricks you can use on Github which can probably make your life easier:</p>
 <a class="read-more" href="/blog/git/github/4-useful-github-tricks.html">Read more &raquo;</a>
    </section>
</article>

  

</main>

      <div id="sidebar">
  <h2 class="category-name">Listing all tags</h2>
    

    
    
        <h3 class="tag-name">
          <a href="/blog/tags/"
             title="Articles about "></a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/agile"
             title="Articles about Agile">Agile</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/aws"
             title="Articles about Aws">Aws</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/backbone"
             title="Articles about Backbone">Backbone</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/benchmark"
             title="Articles about Benchmark">Benchmark</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/best-practices"
             title="Articles about Best Practices">Best Practices</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/bugs"
             title="Articles about Bugs">Bugs</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/carrierwave"
             title="Articles about Carrierwave">Carrierwave</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/case-study"
             title="Articles about Case Study">Case Study</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/circle-ci"
             title="Articles about Circle Ci">Circle Ci</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/continuous-integration"
             title="Articles about Continuous Integration">Continuous Integration</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/conventions"
             title="Articles about Conventions">Conventions</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/crowdsourcing"
             title="Articles about Crowdsourcing">Crowdsourcing</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/design"
             title="Articles about Design">Design</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/docker"
             title="Articles about Docker">Docker</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/dry"
             title="Articles about Dry">Dry</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/git"
             title="Articles about Git">Git</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/github"
             title="Articles about Github">Github</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/hubot"
             title="Articles about Hubot">Hubot</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/imap"
             title="Articles about Imap">Imap</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/jobs"
             title="Articles about Jobs">Jobs</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/lean-startup"
             title="Articles about Lean Startup">Lean Startup</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/linux"
             title="Articles about Linux">Linux</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/maintenance"
             title="Articles about Maintenance">Maintenance</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/mvp"
             title="Articles about Mvp">Mvp</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/open-source"
             title="Articles about Open Source">Open Source</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/pair-programming"
             title="Articles about Pair Programming">Pair Programming</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/performance"
             title="Articles about Performance">Performance</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/protractor"
             title="Articles about Protractor">Protractor</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rails"
             title="Articles about Rails">Rails</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/react"
             title="Articles about React">React</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rspec"
             title="Articles about Rspec">Rspec</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/ruby"
             title="Articles about Ruby">Ruby</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rubygems"
             title="Articles about Rubygems">Rubygems</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/s3"
             title="Articles about S3">S3</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/security"
             title="Articles about Security">Security</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/sessions"
             title="Articles about Sessions">Sessions</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/software-development"
             title="Articles about Software Development">Software Development</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/software-quality"
             title="Articles about Software Quality">Software Quality</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/team"
             title="Articles about Team">Team</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/upgrades"
             title="Articles about Upgrades">Upgrades</a>
        </h3>
    
</div>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script type="text/javascript" src="/blog/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-17795190-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</body>
</html>
