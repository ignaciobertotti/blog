<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    

    <title>AWS S3 Policies for Carrierwave - The Lean Software Boutique</title>


    
    
    <meta name="description" content="When you create IAM credentials and policies foryour app, you should make sure that they have access to the resources that theyneed and not more th..." />
    <meta name="HandheldFriendly" content="True" />
    <meta name="MobileOptimized" content="320" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Schema.org markup for Google+ -->
    <meta itemprop="name" content="AWS S3 Policies for Carrierwave - The Lean Software Boutique">
    <meta itemprop="description" content="When you create IAM credentials and policies for your app, you should make sure that they have access to the resources that they need and not more ...">
    <!-- meta itemprop="image" content="http://www.example.com/image.jpg" -->

    <!-- Twitter Card data -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@OmbuLabs">

    <meta name="twitter:title" content="AWS S3 Policies for Carrierwave - The Lean Software Boutique">
    <meta name="twitter:description" content="When you create IAM credentials and policies for your app, you should make sure that they have access to the resources that they need and not more ...">
    <meta name="twitter:creator" content="@OmbuLabs">
    <!-- Twitter summary card with large image must be at least 280x150px -->
    <!-- meta name="twitter:image:src" content="http://www.example.com/image.html" -->

    <!-- Open Graph data -->
    <meta property="og:title" content="AWS S3 Policies for Carrierwave - The Lean Software Boutique" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="http://www.ombulabs.com/aws/carrierwave/s3/aws-s3-policies-for-carrierwave.html" />
    <meta property="og:image" content="http://www.ombulabs.com/assets/isotype.png" />
    <meta property="og:description" content="When you create IAM credentials and policies for your app, you should make sure that they have access to the resources that they need and not more than that!. This way, if anyone gets access to those credentials, the impact of this leak is reduced to the resources associated with..." />
    <meta property="og:site_name" content="AWS S3 Policies for Carrierwave by @etagwerker" />
    
      <meta property="article:published_time" content="2017-05-10 05:02:00 -0400" />
      <meta property="article:modified_time" content="2017-05-10 05:02:00 -0400" />
      <meta property="article:section" content="When you create IAM credentials and policies for your app, you should make sure that they have access to the resources that they need and not more than that!. This way, if anyone gets access to those credentials, the impact of this leak is reduced to the resources associated with..." />
      <meta property="article:tag" content="AWS S3 Policies for Carrierwave - The Lean Software Boutique" />
    

    <meta property="fb:admins" content="10153304864537860" />

    <link rel="stylesheet" type="text/css" href="/blog/assets/css/screen.css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900,300italic,400italic,700italic|Maven+Pro" rel="stylesheet" type="text/css">
    <!-- Customisation  -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/main.css" />
    <link rel="stylesheet" type="text/css" href="/assets/ombu_blog/application.css" />
</head>
<body class="home-template">
  <header class="main-header no-cover">
      <nav class="main-nav overlay clearfix">
              
              <a class="back-button icon-arrow-left"
                 href="/blog">Home</a>
          <a class="subscribe-button icon-feed" href="/blog/rss.xml">Subscribe</a>
      </nav>
      <div class="vertical">
          <div class="main-header-content inner">
              <h1 class="page-title logo"><a href="/blog">OmbuLabs Blog</a></h1>
              <h2 class="page-description slogan">
                   The Lean Software Boutique 
                  
              </h2>
          </div>
      </div>
      <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
  </header>
    <div id="wrapper">
      <main class="content post-layout" role="main">

    <article class="post">

        <header class="post-header">
            <h1 class="post-title">AWS S3 Policies for Carrierwave</h1>
            <section class="post-meta">
              
              


  
    <img class="author-thumb" src="//2.gravatar.com/avatar/9299203e7e9b9ae35e39eb66f3155f15?s=50" alt="Ernesto Tagwerker" nopin="nopin" />
  
  <a href="/blog/authors/etagwerker"
     title="Articles by Ernesto Tagwerker">
     Ernesto Tagwerker
  </a>


 
  on
    
      <a href="/blog/tags/aws"
         title="Articles about Aws">Aws</a>,
      <a href="/blog/tags/carrierwave"
         title="Articles about Carrierwave">Carrierwave</a>,
      <a href="/blog/tags/s3"
         title="Articles about S3">S3</a>



<time class="post-date" datetime="2017-05-10">
  10 May 2017
</time>

            </section>
        </header>

        <section class="post-content">
          <p>When you create <a href="https://aws.amazon.com/iam/">IAM</a> credentials and policies for
your app, you should make sure that they have access to the resources that they
need <strong>and not more than that!</strong>.</p>

<p>This way, if anyone gets access to those credentials, the impact of this leak
is reduced to the resources associated with them (<strong>and not all the buckets in
your S3 account</strong>)</p>

<!--more-->

<p>If you&#39;re using <a href="https://github.com/carrierwaveuploader/carrierwave">Carrierwave</a>,
you will <em>probably</em> need credentials that have <strong>access</strong> to these buckets:</p>

<ul>
<li>gif-dir-development</li>
<li>gif-dir-test</li>
<li>gif-dir-production</li>
</ul>

<p><a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/example-bucket-policies.html">Creating a policy for this is <strong>not trivial</strong></a>
using the AWS Administration Panel. If you follow the <a href="https://aws.amazon.com/blogs/security/writing-iam-policies-how-to-grant-access-to-an-amazon-s3-bucket/">instructions in the official AWS documentation</a>, you might run into this issue:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>Excon::Error::Socket <span class="o">(</span>Broken pipe <span class="o">(</span>Errno::EPIPE<span class="o">))</span>:
  app/controllers/gifs_controller.rb:64:in <span class="sb">`</span>block in create<span class="s1">&#39;</span>
<span class="s1">  app/controllers/gifs_controller.rb:63:in `create&#39;</span>

  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/actionpack-4.2.6/lib/action_dispatch/middleware/templates/rescues/_source.erb <span class="o">(</span><span class="m">11</span>.7ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/actionpack-4.2.6/lib/action_dispatch/middleware/templates/rescues/_trace.html.erb <span class="o">(</span><span class="m">5</span>.1ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/actionpack-4.2.6/lib/action_dispatch/middleware/templates/rescues/_request_and_response.html.erb <span class="o">(</span><span class="m">1</span>.4ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/actionpack-4.2.6/lib/action_dispatch/middleware/templates/rescues/diagnostics.html.erb within rescues/layout <span class="o">(</span><span class="m">60</span>.9ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/_markup.html.erb <span class="o">(</span><span class="m">0</span>.5ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/_inner_console_markup.html.erb within layouts/inlined_string <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/_prompt_box_markup.html.erb within layouts/inlined_string <span class="o">(</span><span class="m">0</span>.3ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/style.css.erb within layouts/inlined_string <span class="o">(</span><span class="m">0</span>.6ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/console.js.erb within layouts/javascript <span class="o">(</span><span class="m">45</span>.4ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/main.js.erb within layouts/javascript <span class="o">(</span><span class="m">0</span>.7ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/error_page.js.erb within layouts/javascript <span class="o">(</span><span class="m">0</span>.4ms<span class="o">)</span>
  Rendered /Users/etagwerker/.rvm/gems/ruby-2.3.3@gifDir/gems/web-console-2.3.0/lib/web_console/templates/index.html.erb <span class="o">(</span><span class="m">102</span>.7ms<span class="o">)</span>
</code></pre></div>

<p>The issue is documented in Fog&#39;s <a href="https://github.com/fog/fog/issues/1659">issue #1659</a>.
The problem with the official documentation is that it lists only 4 actions:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
  <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;s3:ListBucket&quot;</span><span class="p">],</span>
      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;arn:aws:s3:::gif-dir-development&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
        <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
        <span class="s2">&quot;s3:DeleteObject&quot;</span>
      <span class="p">],</span>
      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;arn:aws:s3:::gif-dir-development/*&quot;</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>These actions are not enough for <a href="https://github.com/carrierwaveuploader/carrierwave">Carrierwave</a>. You will need
to add the <code>&quot;s3:PutObjectAcl&quot;</code> action to the list. While you are at it, you
should add more buckets to the list of resources:</p>

<div class="highlight"><pre><code class="language-json" data-lang="json"><span></span><span class="p">{</span>
    <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;s3:ListBucket&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-development&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-test&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-production&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;s3:PutObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:PutObjectAcl&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:DeleteObject&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-development/*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-test/*&quot;</span><span class="p">,</span>
                <span class="s2">&quot;arn:aws:s3:::gif-dir-production/*&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>After you&#39;ve modified the policy&#39;s JSON, you can update it and associate it to
the IAM user using the AWS administration panel.</p>

        </section>

        

        <footer class="post-footer">
          
            
            <figure class="author-image">
              
                <a class="img" href="" style="background-image: url(//2.gravatar.com/avatar/9299203e7e9b9ae35e39eb66f3155f15?s=50)">
                <span class="hidden">Ernesto Tagwerker's Picture</span></a>
              
            </figure>
            <section class="author">
              <h4> Ernesto Tagwerker </h4>
              <p>
                We are the Lean Software Boutique. Check us out at <a href="http://www.ombulabs.com">www.ombulabs.com</a>
              </p>
            </section>
          

          <!-- Share links section -->
          <section class="share">
    <h4>Share this post</h4>
    <a class="icon-twitter" href="http://twitter.com/share?text=AWS S3 Policies for Carrierwave&amp;url=http://www.ombulabs.com/aws/carrierwave/s3/aws-s3-policies-for-carrierwave.html"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.ombulabs.com/aws/carrierwave/s3/aws-s3-policies-for-carrierwave.html"
        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.ombulabs.com/aws/carrierwave/s3/aws-s3-policies-for-carrierwave.html"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

          <!-- Disqus comments -->
          <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">

        var disqus_shortname = 'ombulabs';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


        </footer>

    </article>
    <footer class="site-footer clearfix">
  <section class="copyright">
    <figure>
      <img src="/blog/assets/images/creative-commons.png"
           alt="Creative Commons Attribution-NonCommercial">
      <figcaption>
        <a href="http://creativecommons.org/licenses/by-nc/3.0/"
           target="_blank"
           title="Creative Commons Attribution-NonCommercial">Creative Commons Attribution-NonCommercial</a>
      </figcaption>
    </figure>
  </section>
  <section class="poweredby">Made with love using <a href="https://github.com/jekyll/jekyll" target="_blank">Jekyll</a> and
    <a target="_blank" href="http://github.com/rosario/kasper">Kasper theme</a>
  </section>
</footer>

</main>

      <div id="sidebar">
  <h2 class="category-name">Listing all tags</h2>
    

    
    
        <h3 class="tag-name">
          <a href="/blog/tags/"
             title="Articles about "></a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/agile"
             title="Articles about Agile">Agile</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/aws"
             title="Articles about Aws">Aws</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/backbone"
             title="Articles about Backbone">Backbone</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/benchmark"
             title="Articles about Benchmark">Benchmark</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/best-practices"
             title="Articles about Best Practices">Best Practices</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/bugs"
             title="Articles about Bugs">Bugs</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/carrierwave"
             title="Articles about Carrierwave">Carrierwave</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/case-study"
             title="Articles about Case Study">Case Study</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/circle-ci"
             title="Articles about Circle Ci">Circle Ci</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/continuous-integration"
             title="Articles about Continuous Integration">Continuous Integration</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/conventions"
             title="Articles about Conventions">Conventions</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/crowdsourcing"
             title="Articles about Crowdsourcing">Crowdsourcing</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/design"
             title="Articles about Design">Design</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/docker"
             title="Articles about Docker">Docker</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/dry"
             title="Articles about Dry">Dry</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/git"
             title="Articles about Git">Git</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/github"
             title="Articles about Github">Github</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/hubot"
             title="Articles about Hubot">Hubot</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/imap"
             title="Articles about Imap">Imap</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/jobs"
             title="Articles about Jobs">Jobs</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/lean-startup"
             title="Articles about Lean Startup">Lean Startup</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/linux"
             title="Articles about Linux">Linux</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/maintenance"
             title="Articles about Maintenance">Maintenance</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/mvp"
             title="Articles about Mvp">Mvp</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/open-source"
             title="Articles about Open Source">Open Source</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/pair-programming"
             title="Articles about Pair Programming">Pair Programming</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/performance"
             title="Articles about Performance">Performance</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/protractor"
             title="Articles about Protractor">Protractor</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rails"
             title="Articles about Rails">Rails</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/react"
             title="Articles about React">React</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rspec"
             title="Articles about Rspec">Rspec</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/ruby"
             title="Articles about Ruby">Ruby</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/rubygems"
             title="Articles about Rubygems">Rubygems</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/s3"
             title="Articles about S3">S3</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/security"
             title="Articles about Security">Security</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/sessions"
             title="Articles about Sessions">Sessions</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/software-development"
             title="Articles about Software Development">Software Development</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/software-quality"
             title="Articles about Software Quality">Software Quality</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/team"
             title="Articles about Team">Team</a>
        </h3>
    
        <h3 class="tag-name">
          <a href="/blog/tags/upgrades"
             title="Articles about Upgrades">Upgrades</a>
        </h3>
    
</div>

    </div>

    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script type="text/javascript" src="/blog/assets/js/index.js"></script>

    <!-- Google Analytics Tracking code -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-17795190-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</body>
</html>
